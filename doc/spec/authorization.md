# Authorization Flow
This system depends on an identity provider that authenticates users.
In this first version we will only implement the OIDC protocol validation.
This is a scheme flow:

![Image of IAM](https://docs.google.com/drawings/d/1NctH8BB6ZB02ig3fR-Wu4tGx52Qpb4vG8Po8fUMoH5E/pub?w=610&h=518)

1. User opens a webapp (client) with a browser.
2. Client sends a request to IDP to get a token for this user.
3. Browser is redirected to IDP authentication endpoint where user uses its credentials to authenticate.
4. IDP redirects user to client. Client uses the code generated by IDP to exchange a valid OIDC token.
5. Client asks the resource provider for a specified resource using the token received by IDP.
6. Resource provider asks to AuthZ sending resource name (urn), action and OIDC token received from client. To avoid this logic there is a proxy tool
that you can use to do the authorization.
7. AuthZ verify the token signature using keys from IDP. 
8. AuthZ sends the resulting effect associated to resources + action + user (extracted from OIDC token).
    - If a resource or some resources are allowed, the resource provider serves the resources to the client.
    - If there isn't any resource allowed, AuthZ response will be 403 forbidden.
